const e=function(){userActions={isEditing:!1,isError:!1},langArray=[{code:"af",language:"Afrikaans"},{code:"al",language:"Albanian"},{code:"ar",language:"Arabic"},{code:"az",language:"Azerbaijani"},{code:"bg",language:"Bulgarian"},{code:"ca",language:"Catalan"},{code:"cz",language:"Czech"},{code:"da",language:"Danish"},{code:"de",language:"German"},{code:"el",language:"Greek"},{code:"en",language:"English"},{code:"eu",language:"Basque"},{code:"fa",language:"Persian (Farsi)"},{code:"fi",language:"Finnish"},{code:"fr",language:"French"},{code:"gl",language:"Galician"},{code:"he",language:"Hebrew"},{code:"hi",language:"Hindi"},{code:"hr",language:"Croatian"},{code:"hu",language:"Hungarian"},{code:"id",language:"Indonesian"},{code:"it",language:"Italian"},{code:"ja",language:"Japanese"},{code:"kr",language:"Korean"},{code:"la",language:"Latvian"},{code:"lt",language:"Lithuanian"},{code:"mk",language:"Macedonian"},{code:"no",language:"Norwegian"},{code:"nl",language:"Dutch"},{code:"pl",language:"Polish"},{code:"pt",language:"Portuguese"},{code:"pt_br",language:"PortuguÃªs Brasil"},{code:"ro",language:"Romanian"},{code:"ru",language:"Russian"},{code:"sv",language:"Swedish"},{code:"sk",language:"Slovak"},{code:"sl",language:"Slovenian"},{code:"sp",language:"Spanish"},{code:"sr",language:"Serbian"},{code:"th",language:"Thai"},{code:"tr",language:"Turkish"},{code:"ua",language:"Ukrainian"},{code:"vi",language:"Vietnamese"},{code:"zh_cn",language:"Chinese Simplified"},{code:"zh_tw",language:"Chinese Traditional"},{code:"zu",language:"Zulu"}];const s=function(e,t){userActions.isError=!0,e.target.parentElement.closest(".grid__item__edit").querySelector(t).classList.add("input-text-error");const n=document.createElement("div");n.className="row-1 error__row";const a=document.createElement("div");a.innerHTML="It must be at least 3 characters",n.innerHTML+=a.outerHTML,e.target.parentElement.closest(".grid__item__edit").after(n)},o=function(e,t){e.target.parentElement.closest(".grid__item__edit").querySelector(t).classList.remove("input-text-error"),userActions.isError&&(document.querySelector(".error__row").remove(),userActions.isError=!1)};return unitArray=["standard","metric","imperial"],{getLangArray:function(){return langArray},getUnitArray:function(){return unitArray},getInputUser:function(e){let t={},n=[],i=e.target.closest(a.getSelectorsClasses().row).querySelectorAll("input"),s=e.target.closest(a.getSelectorsClasses().row).querySelectorAll("select");return i=[...i,...s],i.forEach(e=>n.push([e.getAttribute("id")])),n=n.flat(),i.forEach((e,a)=>{e.getAttribute("id")===n[a]&&(t[n[a]]=e.value)}),t},sendLogin:async function(e){e.preventDefault();const t=n.getUrls();await n.callApi("post",i.selectors().emailInput.value,i.selectors().emailPassword.value,t.URL_POST).then(e=>n.callApiAuth("get",JSON.parse(e).token,t.URL_GET)).then(e=>a.listUsers(e.data))},getToken:function(){return sessionStorage.getItem("UserToken")},getArrUsers:function(){return sessionStorage.getItem("arrUsers")},addUserRow:function(){if(userActions.isEditing)return;let t;t=null===a.getSelectors().locationList.lastElementChild?a.getSelectors().locationList:a.getSelectors().locationList.lastElementChild;let n=a.row();t.after(n),a.iconsEditInit("save"),a.checkboxMainLocationInit(),e.setIsEditingTrue()},saveWeatherUser:async function(t){e.getInputUser(t);let r=e.getInputUser(t);if(r.firstName.length<3)return void s(t,".first__name");if(r.firstName.length>2&&o(t,".first__name"),r.location.length<3)return void s(t,".location");r.location.length>2&&o(t,".location"),!0!==r.mainLocation&&"true"!==r.mainLocation||e.setAlertMain("The new user will change the Main Location! Are you sure?");const c=await n.callApiAuth("post",e.getToken(),i.urls().URL_POST_USER,r);if(c.status>=200&&c.status<=399){r._id=JSON.parse(c.data)._id,r.userCode=JSON.parse(c.data).userCode;let n=JSON.parse(e.getArrUsers());n.push(r),sessionStorage.setItem("arrUsers",JSON.stringify(n));const{_id:i,firstName:s,location:o,language:l,unit:u,userCode:d,mainLocation:g}=r;let m,p=t.target.closest(a.getSelectorsClasses().row);m=null===a.getSelectors().locationList.lastElementChild?a.getSelectors().locationList:a.getSelectors().locationList.lastElementChild,setTimeout(()=>{p.style.opacity="0"},500),setTimeout(()=>{p.remove()},1e3);let _=a.gridItem(s,o,l,u,i,"no");_.style.opacity="0",m.after(_),setTimeout(()=>{_.style.opacity="1"},1500),1!=g&&"true"!=g||e.reInitListUser(),this.setIsEditingFalse(),this.createUserLocation(s,o,u,l,d,g),a.iconsInit()}},createUserLocation:async function(a,s,o,r,c,l){const u=await t.openWCallApi(s,o,r),d=JSON.parse(u),{getLocation:g=d.name,getMain:m=d.weather[0].main,getIcon:p=d.weather[0].icon,getMainDesc:_=d.weather[0].description,getTemp:L=d.main.temp,getWind:h=d.wind.speed,getTimeZone:f=d.timezone}=d,A={firstName:a,language:r,description:_,unit:o,icon:p,location:g,mainWeather:m,temperature:L,userCode:c,wind:h,mainLocation:l,timezone:f};return await n.callApiAuth("post",e.getToken(),i.urls().URL_POST_LOCATION,A,"")},updateUserLocation:async function(a,s,o,r,c,l,u){const d=await t.openWCallApi(s,o,r),g=JSON.parse(d),{getLocation:m=g.name,getMain:p=g.weather[0].main,getIcon:_=g.weather[0].icon,getMainDesc:L=g.weather[0].description,getTemp:h=g.main.temp,getWind:f=g.wind.speed,getTimeZone:A=g.timezone}=g,E={firstName:a,language:r,description:L,unit:o,icon:_,location:m,mainWeather:p,temperature:h,userCode:l,wind:f,mainLocation:c,timezone:A},S=await n.callApiAuth("get",e.getToken(),i.urls().URL_GET_LOCATION),y=await JSON.parse(S.data).find(e=>e.userCode===l);return await n.callApiAuth("put",e.getToken(),i.urls().URL_PUT_LOCATION,E,y._id)},deleteUserLocation:async function(t){const a=await n.callApiAuth("get",e.getToken(),i.urls().URL_GET_LOCATION),s=await JSON.parse(a.data).find(e=>e.userCode===t);return await n.callApiAuth("delete",e.getToken(),i.urls().URL_DELETE_LOCATION,"",s._id)},reInitListUser:async function(){a.getSelectors().locationList.innerHTML="";const t=await n.callApiAuth("get",e.getToken(),i.urls().URL_GET);let s=JSON.parse(t.data).sort((e,t)=>t.mainLocation-e.mainLocation);a.listUsers(JSON.stringify(s))},undoEditWeatherUser:function(e){e.preventDefault(),this.setIsEditingFalse(),e.target.closest(a.getSelectorsClasses().gridItemEdit).remove()},getIsEditing:function(){return userActions.isEditing},setIsEditingTrue:function(){userActions.isEditing=!0,a.getSelectors().btnAddUser.disabled=!0},setIsEditingFalse:function(){userActions.isEditing=!1,a.getSelectors().btnAddUser.disabled=!1},setAlert:async function(t,n,a,i,s){e.setIsEditingTrue(),a.classList.add("row__deleting");const o=document.createElement("div");let r=`<div class='row delete__row ${n}'>\n      <div class="msg col-6 t-center-y">${t}</div>\n      <div class='col-2'><button class="btn-alert-yes">Yes</button></div>\n      <div class='col-2'><button class="btn-alert-no" >No</button></div>\n      </div>\n      `;var c=(new DOMParser).parseFromString(r,"text/html");o.appendChild(...c.body.children),a.after(o),document.querySelector(".btn-alert-no").addEventListener("click",(function(){i()})),document.querySelector(".btn-alert-yes").addEventListener("click",(function(){s()}))},setAlertMain:async function(e){return confirm(e)}}}(),t=function(){const e="https://api.openweathermap.org/data/2.5/weather?q=",t="169986ea94b386da8e6d479f3e6971d0";return{openWCallApi:async function(n,a,i){const s=`${e}${n}&units=${a}&appid=${t}&lang=${i}`;try{const e={method:"get",url:s,transformResponse:[e=>e]};return(await axios(e)).data}catch(e){console.error(e)}return i}}}(),n=function(){const e={URL_POST:"http://localhost:5000/api/auth",URL_POST_USER:"http://127.0.0.1:5000/api/weatherusers/",URL_GET:"http://127.0.0.1:5000/api/weatherusers",URL_DELETE:"http://127.0.0.1:5000/api/weatherusers/",URL_PUT:"http://127.0.0.1:5000/api/weatherusers/",URL_GET_LOCATION:"http://127.0.0.1:5000/api/locations/",URL_POST_LOCATION:"http://127.0.0.1:5000/api/locations/",URL_PUT_LOCATION:"http://127.0.0.1:5000/api/locations/",URL_DELETE_LOCATION:"http://127.0.0.1:5000/api/locations/"};return{getUrls:function(){return e},callApi:async function(e,t,n,a){try{const i={method:e,data:{email:t,password:n},url:a,transformResponse:[e=>e]};return(await axios(i)).data}catch(e){console.error(e)}},callApiAuth:async function(e,t,n,a={},i=""){"delete"!==e&&"put"!==e||(n=`${n}/${i}`);try{const i={method:e,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+t},data:a,url:n,transformResponse:[e=>e]},s=await axios(i);return s.status>=200&&s.status<=399&&(sessionStorage.setItem("isAuthenticated",!0),sessionStorage.setItem("UserToken",t)),s}catch(e){console.error(e)}}}}(),a=function(){const t={formLogin:".form__login",btnLogin:".btn-login",emailInput:".email",emailPassword:".password",btnAddUser:".btn-add-user",locationList:".locations__list",iconEdit:".edit__icon",iconDelete:".delete__icon",iconUpdateWeaUser:".btn__update__weather__user",iconUndoWeaUser:".btn__undo__weather__user",gridItem:".grid__item",row:".row",firstName:".first__name",location:".location",language:".language",unit:".unit",mainLocation:".main__location",gridItemEdit:".grid__item__edit",menu:".menu"},s={formLogin:document.querySelector(t.formLogin),btnLogin:document.querySelector(t.btnLogin),emailInput:document.querySelector(t.emailInput),emailPassword:document.querySelector(t.emailPassword),btnAddUser:document.querySelector(t.btnAddUser),locationList:document.querySelector(t.locationList),menu:document.querySelector(t.menu)};return{gridItem:function(t,n,i,s,o,r,c="yes"){t=t.charAt(0).toUpperCase()+t.slice(1),n=n.charAt(0).toUpperCase()+n.slice(1);let l="";e.getLangArray().map(e=>{e.code===i&&(l=e.language)});const u=document.createElement("div");u.className="row grid__item ph-1 t-center-y";const d=document.createElement("div");d.className="col-3 first__name",d.innerHTML=t;const g=document.createElement("div");g.className="col-3 location",g.innerHTML=n;const m=document.createElement("div");m.className="col-2 language",m.innerHTML=l;const p=document.createElement("div");p.className="col-1 unit",p.innerHTML=s;const _=document.createElement("div");_.className="col-1 edit__icon pl-2",_.dataset.id=o,_.innerHTML='<button class="btn__edit"><i class="far fa-1x fa-edit"></i></button>';const L=document.createElement("div");L.className="col-1 delete__icon",L.dataset.id=o,L.innerHTML='<button class="btn__delete"><i class="far fa-trash-alt"></i></button>';const h=document.createElement("div");return h.className="col-1 main__location",1!=r&&"true"!=r||(a.setMainLocationStyle(u),setTimeout(()=>{document.querySelector(".btn__delete").remove()},10)),u.innerHTML+=d.outerHTML+g.outerHTML+m.outerHTML+p.outerHTML+_.outerHTML+L.outerHTML+h.outerHTML,"yes"===c?this.getSelectors().locationList.appendChild(u):u},row:function(t="",n="",a="",i="",s="",o){const r=document.createElement("div");r.className="row grid__item__edit pv-1 ph-1 t-center-y";const c=document.createElement("input");c.className="col-3 edit__input first__name input-text-large",c.setAttribute("type","text"),c.setAttribute("id","firstName"),c.setAttribute("value",n);const l=document.createElement("input");l.className="col-3 edit__input location input-text-large",l.setAttribute("type","text"),l.setAttribute("id","location"),l.setAttribute("value",a);const u=document.createElement("select");u.className="col-1 edit__input language input-text-small",u.setAttribute("type","text"),u.setAttribute("id","language"),u.setAttribute("value",i),e.getLangArray().forEach((e,t)=>{let n=document.createElement("option");null===i||""===i?n.value=e.code:e.code===i&&(n.setAttribute("selected","selected"),n.value=e.code),n.value=e.code,n.textContent=e.language,u.appendChild(n)});const d=document.createElement("select");d.className="col-2 edit__input unit input-text-med",d.setAttribute("type","text"),d.setAttribute("id","unit"),d.setAttribute("value",s),e.getUnitArray().forEach((e,t)=>{let n=document.createElement("option");null===s||""===s?n.value=e:e===s&&(n.setAttribute("selected","selected"),n.value=s),n.value=e,n.textContent=e,d.appendChild(n)});const g=document.createElement("div");g.className="col-1 save__icon pl-1",g.dataset.id=t,g.innerHTML='<button class="btn__update__weather__user"><i class="fas fa-save"></i></button>';const m=document.createElement("div");m.className="col-1 undo__icon pr-1",m.dataset.id=t,m.innerHTML='<button class="btn__undo__weather__user"><i class="fas fa-times"></i></button>';const p=document.createElement("input");return p.className="col-1 main__location",p.setAttribute("type","checkbox"),p.setAttribute("id","mainLocation"),p.setAttribute("value",!1),1!=o&&"true"!=o||(p.setAttribute("value",!0),p.setAttribute("checked",!0),setTimeout(()=>{document.querySelector("#mainLocation").style.opacity=0},1)),r.innerHTML+=c.outerHTML+l.outerHTML+u.outerHTML+d.outerHTML+g.outerHTML+m.outerHTML+p.outerHTML,r},setMainLocationStyle:function(e){e.classList.add("main__location___row")},getSelectors:function(){return s},getSelectorsClasses:function(){return t},submitEdit:function(t){if(e.getIsEditing())return;let n=t.target.closest(a.getSelectorsClasses().row),i=t.target.parentElement.parentElement.getAttribute("data-id"),s=JSON.parse(sessionStorage.getItem("arrUsers"));const{_id:o,firstName:r,location:c,language:l,unit:u,mainLocation:d}=s.find(e=>e._id===i);let g=a.row(o,r,c,l,u,d);n.after(g),a.iconsEditInit("update"),a.checkboxMainLocationInit(),e.setIsEditingTrue()},submitDelete:async function(t){if(t.preventDefault(),e.getIsEditing())return;let s=t.target.parentElement.closest(a.getSelectorsClasses().gridItem),o=t.target.parentElement.parentElement.parentElement.querySelector(a.getSelectorsClasses().firstName).textContent,r=t.target.parentElement.parentElement.parentElement.querySelector(a.getSelectorsClasses().location).textContent;e.setAlert(`Are you sure to delete ${o} from ${r}?`,"classeDelete",s,(async function(){s.classList.remove("row__deleting"),t.target.closest(a.getSelectorsClasses().locationList).querySelector(".delete__row").remove(),e.setIsEditingFalse()}),(async function(){let a=t.target.parentElement.parentElement.getAttribute("data-id"),r=await JSON.parse(e.getArrUsers()).find(e=>e._id===a).userCode;const c=await n.callApiAuth("delete",e.getToken(),i.urls().URL_DELETE,{},a);if(c.status>=200&&c.status<=399){let t=JSON.parse(e.getArrUsers()).slice();JSON.parse(e.getArrUsers()).filter((e,n)=>{e._id===a&&t.splice(n,1)}),sessionStorage.setItem("arrUsers",JSON.stringify(t)),s.style.transition="all 2s",s.classList.remove("row"),s.style.opacity="0",s.innerHTML=o+" successfully removed",s.style.opacity="1",setTimeout(()=>{s.style.opacity="0"},1e3),setTimeout(()=>{s.remove()},3e3),e.deleteUserLocation(r)}}))},updateWeatherUser:async function(t){t.preventDefault();let s=t.target.parentElement.parentElement.getAttribute("data-id"),o=e.getInputUser(t);!0!==o.mainLocation&&"true"!==o.mainLocation||e.setAlertMain("Your update will change the Main Location! Are you sure?"),o._id=s;const r=await n.callApiAuth("put",e.getToken(),i.urls().URL_PUT,o,o._id),{firstName:c,location:l,unit:u,language:d,mainLocation:g,_id:m}=o;if(r.status>=200&&r.status<=399){let n=JSON.parse(e.getArrUsers()).slice();JSON.parse(e.getArrUsers()).filter((e,t)=>{e._id===s&&n.splice(t,1,o)}),sessionStorage.setItem("arrUsers",JSON.stringify(n));let i=t.target.closest(a.getSelectorsClasses().gridItemEdit),r=t.target.parentElement.parentElement.parentElement.previousElementSibling,c="";e.getLangArray().map(e=>{e.code===d&&(c=e.language)}),setTimeout(()=>{r.querySelector(a.getSelectorsClasses().firstName).innerHTML=o.firstName,r.querySelector(a.getSelectorsClasses().location).innerHTML=o.location,r.querySelector(a.getSelectorsClasses().language).innerHTML=c,r.querySelector(a.getSelectorsClasses().unit).innerHTML=o.unit},500),setTimeout(()=>{i.style.opacity="0"},1e3),setTimeout(()=>{i.remove(),1!=o.mainLocation&&"true"!=o.mainLocation||a.setMainLocationStyle(r)},1500)}1!=g&&"true"!=g||e.reInitListUser(),e.setIsEditingFalse(),e.updateUserLocation(c,l,u,d,g,userCode=JSON.parse(r.data).userCode,m)},listUsers:function(e){let t=JSON.parse(e).sort((e,t)=>t.mainLocation-e.mainLocation);a.showMenu(),i.selectors().formLogin.remove(),sessionStorage.setItem("arrUsers",e),t.map(e=>this.gridItem(e.firstName,e.location,e.language,e.unit,e._id,e.mainLocation)),this.iconsInit(),this.checkboxMainLocationInit()},iconsInit:function(){document.querySelectorAll(this.getSelectorsClasses().iconEdit).forEach(e=>e.addEventListener("click",this.submitEdit)),document.querySelectorAll(this.getSelectorsClasses().iconDelete).forEach(e=>e.addEventListener("click",this.submitDelete))},iconsEditInit:function(t){document.querySelector(a.getSelectorsClasses().iconUpdateWeaUser).addEventListener("click",(function(n){"update"===t?a.updateWeatherUser(n):e.saveWeatherUser(n)})),document.querySelector(a.getSelectorsClasses().iconUndoWeaUser).addEventListener("click",(function(t){e.undoEditWeatherUser(t)}))},checkboxMainLocationInit:function(){document.querySelectorAll(a.getSelectorsClasses().mainLocation).forEach(e=>e.addEventListener("click",(function(e){"null"!=this.getAttribute("value")&&null!=this.getAttribute("value")||this.setAttribute("value","true"),"true"==this.getAttribute("value")||1==this.getAttribute("value")?(this.setAttribute("value","false"),this.removeAttribute("checked")):"false"!=this.getAttribute("value")&&0!=this.getAttribute("value")||this.setAttribute("value","true")})))},showMenu:function(){i.selectors().menu.classList.remove("hide")}}}(),i=function(e,t,n,a){const s=n.getUrls(),o=t.getSelectors();return{init:function(){sessionStorage.getItem("isAuthenticated")&&(i.selectors().formLogin.classList.add("hide"),t.showMenu(),t.listUsers(sessionStorage.getItem("arrUsers"))),sessionStorage.getItem("isAuthenticated")||(document,i.selectors().formLogin.classList.remove("hide")),o.btnLogin.addEventListener("click",(function(t){e.sendLogin(t)})),o.btnAddUser.addEventListener("click",e.addUserRow)},selectors:()=>o,urls:()=>s}}(e,a,n);i.init();